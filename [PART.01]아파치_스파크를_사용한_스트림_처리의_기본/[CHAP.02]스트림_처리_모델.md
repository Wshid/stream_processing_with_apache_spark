## [CHAP.02] 스트림 처리 모델
- 스트림 처리의 구성 요소
  - 데이터 소스
  - 스트림 처리 파이프라인
  - 데이터 싱크
- 과거 계산 기록 : bookeeping
  - 상태 기반 스트림 처리 특성화
- 문제 해결
  - **이벤트 도착 순서**와 **적시성**이 일치하지 않으면 어떻게 할 것 인가
  - 타임스탬프 이벤트 스트림과 기본 개념

### 2.1. 소스와 싱크
- 두가지 스트리밍 시스템
  - 구조적 스트리밍
  - 스파크 스트리밍
- 프로그램의 Runtime에 입력된 데이터에 대해서만 작동 가능
  - **다른 시스템으로 전송되는 즉시**, 데이터에 대한 작동 중지
- 데이터 소스
  - 아파치 스파크의 **스트리밍 프레임워크**에서 데이터 스트림 접근 가능
  - 스트림 처리의 맥락에서
    - 스트림으로부터 데이터에 접근하는 것을 **스트림 소비**(consuming the stream)라고 함
  - 이 추상화는 `kafka`, `flume`, `twitter`, `tcp socket`등과 같은
    - 특정 시스템에 연결하려는 **인스턴스의 구현**을 허용하는 인터페이스로 제공
- streaming sink
  - `spark`외부에 데이터 스트림을 쓰는데 사용
- 스트림 처리 시스템 구성
  - `source - process - sink`
- `source`와 `sink`는 **시스템의 경계**를 나타냄
  - 분산 프레임 워크가 컴퓨팅 리소스간에 매우 복잡한 footprinting을 가질 수 있음
    - 예시 : spark가 다른 `spark cluster` 혹은 `kafka`가 사용되는 다른 분산 시스템에 연결 할 수 있음
- 하나의 `sink`는 다운 스트림 프레임워크의 `source`
  - 일반적으로 이 구성을 `pipeline`이라고 함

## 2.2. 서로 정의된 불변의 스트림
- spark의 두 스트림 API는 **FP**의 형식을 따름
- `data stream`에서 작동하는 **변환/집계**는
  - 해당 스트림이 **변경 불가능**하다고 가정하여 선언
- 따라서 **하나의 주어진 스트림에 대해 하나 또는 여러 개의 요소를 변형하는 것은 불가능**
- 대신, 파싱된 데이터 스트림을 얻기 위해
  - 한 스트림의 콘텐츠를 처리하는 방법을 표현하기 위한 **변환**을 사용
- 이는 프로그램의 어느 특정 지점에서도 프로그램에서
  - **명시적**으로 선언한 일련의 **변환** 및 **조작**을 통해
  - 모든 데이터 스트림을 그것의 **입력**으로 추적할 수 있게 함
- spark cluster의 특정 프로세스는
  - **프로그램**과 **입력 데이터**만 사용하여
  - 데이터 스트림의 내용을 **째구성**할 수 있어 계산이 명확, 재현 가능

## 2.3. 변환과 집계
- spark는 `translation`, `aggregation`을 광범위하게 사용
- **변환**은 스트림의 모든 요소에 대해
  - 동일한 방식으로 **자신을 표현하는 계산**을 의미
  - 예시
    - 입력 스트림의 모든 요소를 두 배로 만들어주는
    - **파생 스트림**을 생성하는 것은, **변환**에 해당
- **집계**는
  - 많은 요소와 **현재까지 관찰된 스트림의 모든 요소에 의존**하는 결과를 생성
  - 예시
    - 입력 스트림 중 상위 `5`개의 숫자를 수집
    - 매 10분마다 일부 판독값의 **평균**을 계산
- **변환**은 **좁은 종속성**
  - 출력의 한 요소를 생성하려면, **입력 요소중 하나만 필요한 특성**
- **집계**는 **넓은 종속성**
  - 출력의 한 요소를 생성하려면, **지금까지 발생한 입력 스트림의 많은 요소 관찰**
- 이를 통해 **고차 함수**를 사용하여
  - 결과를 생성하는 기본 함수 표현 가능
- `spark streaming`과 `structured streaming`은
  - 데이터 스트림을 나타내는 **고유한 방법**이 있지만
  - 작동하는 `API`는 본질적으로 비슷함
    - **불변 입력 스트림**에 적용되는 일련의 **변환**형태로 존재하며
    - 적정한 **스트림**또는 **출력 작업**으로 **출력 스트림 생성**
