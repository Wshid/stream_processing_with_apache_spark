# [CHAP.13] 고급 상태 기반 작업
- CHAP.08 - 구조적 스트리밍에서의 집계
- CHAP.12 - 이벤트 시간 처리
- 단, **기본 제공 모델**에서 직접 지원하지 않는 **사용자 지정 집계 기준**을 충족해야하는 경우 존재
  - 이 상황을 해결하기 위해 **고급 상태 기반 작업**을 수행하는 방법
- **구조적 스트리밍**은 **임의의 상태 기반 처리**를 구현하는 API 제공
  - 이 `API`는 `mapGroupsWithState` 및 `flatMapGroupsWithState`의 두가지 작업으로 표현
  - 두 작업 모두 **상태**의 **사용자 정의**를 만들고
  - 시간이 지남에 따라 새로운 데이터가 들어올 때,
    - 이 상태가 **어떻게 발전하는지**에 대한 규칙을 설정
    - **만료시기** 결정
  - **상태 정의**를 `들어오는 데이터`와 결합하여 **결과를 산출하는 방법** 제공
- `mapGroupsWithState` 및 `flaptMapGroupsWithState`의 차이점
  - `mapGroupsWithState`: 각 처리된 그룹에 대해 **단일 결과** 생성
  - `flaptMapGroupsWithState`: `0개 이상`의 결과 생성
  - 의미론적으로
    - `새로운 데이터`가 항상 `새로운 상태`로 귀결 => `mapGroupsWithState` 사용
    - `다른 모든 경우` => `flatMapGroupsWithState` 사용
- 내부적으로 **구조적 스트리밍**은
  - **운영 간의 상태 관리**를 담당하며
  - 시간이 지남에 따라 **스트리밍 프로세스**동안 **가용성**과 **내결함성 보존**을 보장